<?xml version="1.0" encoding="utf-8"?>
<Window
    x:Class="IntegradorApi.IntegradorApi"
    Title="Integrador API"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:IntegradorApi"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:controls="using:CommunityToolkit.WinUI.UI.Controls"
    mc:Ignorable="d"
    xmlns:h="using:H.NotifyIcon"
    xmlns:viewmodels="using:IntegradorApi.ViewModels">

    <Grid x:Name="RootGrid" Loaded="OnWindowLoaded">
        <TabView IsAddTabButtonVisible="False" VerticalAlignment="Stretch">
            <TabView.TabItems>
                <TabViewItem Header="Sincronização" IsClosable="False">
                    <TabViewItem.IconSource>
                        <SymbolIconSource Symbol="Sync"/>
                    </TabViewItem.IconSource>
                    <TabViewItem.Content>
                        <Grid Padding="15">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>

                            <Grid Grid.Column="0" Margin="0,0,20,0">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="*" />
                                </Grid.RowDefinitions>

                                <Border Grid.Row="0"
                                        Background="{ThemeResource LayerFillColorDefaultBrush}"
                                        BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                        BorderThickness="1" CornerRadius="4" Padding="10"
                                        Margin="0,0,0,10" MinHeight="60">
                                    <ItemsControl x:Name="StatusConectionsItemsControl" HorizontalAlignment="Center">
                                        <ItemsControl.ItemsPanel>
                                            <ItemsPanelTemplate>
                                                <StackPanel Orientation="Horizontal" Spacing="15"/>
                                            </ItemsPanelTemplate>
                                        </ItemsControl.ItemsPanel>

                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate x:DataType="viewmodels:ConnectionStatusViewModel">
                                                <Grid>
                                                    <FontIcon FontFamily="Segoe Fluent Icons" Glyph="&#xE753;" FontSize="24"
                                                          Foreground="{Binding StatusBrush, Mode=OneWay}"
                                                          PointerPressed="Pressed_StatusIcon"/>
                                                    <ToolTipService.ToolTip>
                                                        <ToolTip Content="{Binding Connection.Description}"/>
                                                    </ToolTipService.ToolTip>
                                                </Grid>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                </Border>

                                <Border Grid.Row="1"
                                        Background="{ThemeResource LayerFillColorDefaultBrush}"
                                        BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                        BorderThickness="1" CornerRadius="4">
                                    <ScrollViewer VerticalScrollBarVisibility="Auto">
                                        <TextBlock x:Name="LogTextBlock"
                                                   Padding="10" FontFamily="Consolas"
                                                   TextWrapping="Wrap"
                                                   Text="Iniciando sistema de log..."/>
                                    </ScrollViewer>
                                </Border>
                            </Grid>

                            <StackPanel Grid.Column="1" Spacing="10">
                                <Button x:Name="TestarConexoesButton" HorizontalAlignment="Stretch">
                                    <StackPanel Orientation="Horizontal" Spacing="8">
                                        <SymbolIcon Symbol="Find"/>
                                        <TextBlock Text="Testar Conexões"/>
                                    </StackPanel>
                                </Button>
                                <Button x:Name="BtnToggleSync" HorizontalAlignment="Stretch" Click="ButtonClick_ToggleSyncronize"/>
                                <Button x:Name="BtnClearLog" HorizontalAlignment="Stretch" Click="ButtonClick_ClearLog">
                                    <StackPanel Orientation="Horizontal" Spacing="8">
                                        <SymbolIcon Symbol="Delete"/>
                                        <TextBlock Text="Limpar Log"/>
                                    </StackPanel>
                                </Button>
                                <Button x:Name="MinimizeToTrayButton" HorizontalAlignment="Stretch" Click="ButtonClick_MinimizeToTray">
                                    <StackPanel Orientation="Horizontal" Spacing="8">
                                        <SymbolIcon Symbol="Download"/>
                                        <TextBlock Text="Minimizar na Bandeja"/>
                                    </StackPanel>
                                </Button>
                            </StackPanel>
                        </Grid>
                    </TabViewItem.Content>
                </TabViewItem>

                <TabViewItem Header="Conexões" IsClosable="False">
                    <TabViewItem.IconSource>
                        <SymbolIconSource Symbol="World"/>
                    </TabViewItem.IconSource>
                    <TabViewItem.Content>
                        <ScrollViewer>
                            <Grid Padding="20" RowSpacing="20">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="*" />
                                </Grid.RowDefinitions>

                                <StackPanel Grid.Row="0" Spacing="10">
                                    <TextBlock Text="Dados da Conexão de Destino" Style="{ThemeResource TitleTextBlockStyle}"/>
                                    <TextBox x:Name="TxtLocalDataBaseDescription" Header="Descrição"/>
                                    <Grid ColumnSpacing="10">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        <TextBox Grid.Column="0" x:Name="TxtLocalDataBaseAddress" Header="Endereço do Servidor"/>
                                        <TextBox Grid.Column="1" x:Name="TxtLocalDataBasePort" Header="Porta" Width="100"/>
                                    </Grid>
                                    <Grid ColumnSpacing="10">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <TextBox Grid.Column="0" x:Name="TxtLocalDataBaseUser" Header="Usuário"/>
                                        <PasswordBox Grid.Column="1" x:Name="PswLocalDataBasePassword" Header="Senha" PasswordRevealMode="Hidden"/>
                                    </Grid>
                                    <StackPanel Orientation="Horizontal" Spacing="10" HorizontalAlignment="Right" Margin="0,10,0,0">
                                        <Button x:Name="BtnCancelConnection" Content="Cancelar" Click="Click_CancelConnection"/>
                                        <Button x:Name="BtnTestConnection" Content="Testar Conexão" Click="Click_TestConnection"/>
                                        <Button x:Name="BtnSaveConnection" Content="Salvar Alterações" Style="{ThemeResource AccentButtonStyle}" Click="Click_SaveConnection"/>
                                    </StackPanel>
                                </StackPanel>

                                <Grid Grid.Row="1">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="*"/>
                                    </Grid.RowDefinitions>
                                    <TextBlock Grid.Row="0" Text="Fontes de Dados de Origem" Style="{ThemeResource TitleTextBlockStyle}" Margin="0,0,0,10"/>

                                    <StackPanel Grid.Row="1" Spacing="10" Margin="0,0,0,20">
                                        <Grid ColumnSpacing="10">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>
                                            <ComboBox Grid.Column="0" x:Name="OrigemTipoComboBox" Header="Tipo" PlaceholderText="Selecione" MinWidth="180">
                                                <ComboBoxItem>REST API</ComboBoxItem>
                                                <ComboBoxItem>MySQL</ComboBoxItem>
                                                <ComboBoxItem>PostgreSQL</ComboBoxItem>
                                            </ComboBox>
                                            <TextBox Grid.Column="1" x:Name="OrigemDescricaoTextBox" Header="Descrição"/>
                                        </Grid>
                                        <TextBox x:Name="OrigemEnderecoTextBox" Header="Endereço (URL)"/>
                                        <Grid ColumnSpacing="10">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>
                                            <TextBox Grid.Column="0" x:Name="OrigemUserTextBox" Header="Usuário"/>
                                            <TextBox Grid.Column="1" x:Name="OrigemPasswordTextBox" Header="Senha"/>
                                        </Grid>
                                        <Grid ColumnSpacing="10">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <TextBox Grid.Column="0" x:Name="OrigemOptionalTextBox" Header="Campo Opcional"/>
                                            <CheckBox Grid.Column="1" x:Name="OrigemEnabledCheckBox" Content="Ativo" VerticalAlignment="Center" Margin="0,24,0,0" IsChecked="True"/>
                                        </Grid>
                                        <StackPanel Orientation="Horizontal" Spacing="10" HorizontalAlignment="Right">
                                            <Button x:Name="ExcluirOrigemButton" VerticalAlignment="Bottom" Click="Click_DeleteSource">
                                                <StackPanel Orientation="Horizontal" Spacing="8">
                                                    <SymbolIcon Symbol="Delete"/>
                                                    <TextBlock Text="Excluir"/>
                                                </StackPanel>
                                            </Button>
                                            <Button x:Name="AdicionarOrigemButton" VerticalAlignment="Bottom" Click="Click_AddSource">
                                                <StackPanel Orientation="Horizontal" Spacing="8">
                                                    <SymbolIcon Symbol="Add"/>
                                                    <TextBlock Text="Adicionar"/>
                                                </StackPanel>
                                            </Button>
                                        </StackPanel>
                                    </StackPanel>

                                    <controls:DataGrid Grid.Row="2" x:Name="SourceDataGrid" AutoGenerateColumns="False" IsReadOnly="True" GridLinesVisibility="Horizontal" CanUserSortColumns="True" MinHeight="300" DoubleTapped="DoubleTapped_SourceDataGrid">
                                        <controls:DataGrid.Columns>
                                            <controls:DataGridTemplateColumn Header="Ativo" Width="SizeToHeader">
                                                <controls:DataGridTemplateColumn.CellTemplate>
                                                    <DataTemplate>
                                                        <CheckBox IsChecked="{Binding Enabled, Mode=TwoWay}" Click="Click_SourceEnabled"/>
                                                    </DataTemplate>
                                                </controls:DataGridTemplateColumn.CellTemplate>
                                            </controls:DataGridTemplateColumn>

                                            <controls:DataGridTextColumn Header="Tipo" Binding="{Binding TypeConnection}" Width="SizeToCells"/>
                                            <controls:DataGridTextColumn Header="Descrição" Binding="{Binding Description}" Width="*"/>
                                            <controls:DataGridTextColumn Header="Endereço (URL)" Binding="{Binding Address}" Width="2*"/>

                                            <controls:DataGridTemplateColumn Width="SizeToHeader">
                                                <controls:DataGridTemplateColumn.CellTemplate>
                                                    <DataTemplate>
                                                        <Button Click="Click_TestGridConnection" Padding="4" Height="32" Width="32"
                                                                ToolTipService.ToolTip="Testar esta conexão">
                                                            <SymbolIcon Symbol="Sync"/>
                                                        </Button>
                                                    </DataTemplate>
                                                </controls:DataGridTemplateColumn.CellTemplate>
                                            </controls:DataGridTemplateColumn>
                                        </controls:DataGrid.Columns>
                                    </controls:DataGrid>
                                </Grid>
                            </Grid>
                        </ScrollViewer>
                    </TabViewItem.Content>
                </TabViewItem>
            </TabView.TabItems>
        </TabView>

        <h:TaskbarIcon
            x:Name="MyTaskbarIcon"
            IconSource="Assets/integrador_icon.ico"
            ToolTipText="Integrador API"
            Visibility="Collapsed">
            <h:TaskbarIcon.ContextFlyout>
                <MenuFlyout x:Name="TrayMenuFlyout">
                    <MenuFlyoutItem Text="Restaurar" Click="Click_RestoreWindow"/>
                    <MenuFlyoutSeparator/>
                    <MenuFlyoutItem Text="Fechar Aplicação" Click="Click_ExitApp"/>
                </MenuFlyout>
            </h:TaskbarIcon.ContextFlyout>
        </h:TaskbarIcon>
    </Grid>
</Window>